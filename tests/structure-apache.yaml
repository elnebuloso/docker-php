schemaVersion: "2.0.0"

metadataTest:
  exposedPorts: ["80"]

fileContentTests:
  - name: "Apache2 Config expose-env.conf"
    path: "/etc/apache2/conf-available/expose-env.conf"
    expectedContents: ['PassEnv APP_ENV']

  - name: "Apache2 Config log-formats.conf"
    path: "/etc/apache2/conf-available/log-formats.conf"
    expectedContents: ['combined_noip', 'common_noip']

  - name: "Apache2 Config security.conf"
    path: "/etc/apache2/conf-available/security.conf"
    expectedContents: ['ServerTokens Prod', 'ServerSignature Off', 'TraceEnable Off']

  - name: "Apache2 Config servername.conf"
    path: "/etc/apache2/conf-available/servername.conf"
    expectedContents: ['ServerName localhost']

commandTests:
  - name: "Apache2 Server"
    command: "/usr/sbin/apache2ctl"
    args: ["-v"]
    expectedOutput: ['Apache/2\.4']

  - name: "Apache2 Server Modules"
    command: "/usr/sbin/apache2ctl"
    args: ["-t", "-D", "DUMP_MODULES"]
    expectedOutput: ["php\\d_module", "rewrite_module", "security2_module", "setenvif_module", "headers_module"]
